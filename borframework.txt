Borframework.txt - BrailleOrch Software Development Framework

By Hu Haipeng

Date: Jan 31, 2016

Project devel site: https://github.com/barichd/brailleorch

Copyright (C) 2015 By Hu Haipeng <hhpcomposer@gmail.com> and Daniel Barich <barichd@kenyon.edu>

========================================

BrailleOrch is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

BrailleOrch is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with BrailleOrch.  If not, see <http://www.gnu.org/licenses/>.

========================================

Contents
Purpose
Requirements
About BrailleOrch Format
Framework
Working Progress
Chapter 1: Menu Overview
1.1 File Menu
1.2 Edit Menu
1.3 View Menu
1.4 Navigation Menu
1.5 Transcription Menu
1.6 Braille Music Menu
1.7 Playback Menu
1.8 Options Menu
1.9 Window Menu
1.10 Help Menu
Chapter 2: Deeper view of transcription function
2.1 Transcription Dialog
2.2 Score Management Dialog
2.3 Part Management Dialog
2.4 Text Management Dialog
2.5 Lyrics Management Dialog
Chapter 3: Braille Music Editing And Debugging Related Points
3.1 Entering And Marking Items
3.2 Debugging Dialog
Chapter 4: Options Dialog
========================================

Purpose
This is a detailed framework of BrailleOrch, braille music transcription software for advanced publishing requirements. The final software will convert Musicxml files, or via a separate plugin, Sibelius files, into our extended Braille Music Markup Language (BMML) format (originally created and copyrighted by Veia Progetti s.r.l. [http://www.veia.it], Italy, as free software. See copyright information in the BMML package for details), which can be flexibly edited and modified, to fulfill most of the requirements of braille music publishment.

Since this software is free, and under GPL and Veia free software licenses, anyone who are willing to help us can join in to develop it. We welcome people around the world to do anything making convenience to braille music production for blind musicians.

Requirements
An experienced Python and XML knowledge is required for developing this software. A basic Github knowledge is required for committing changes. Knowledge of music, musicxml, braille and/or braille music is recommended, which will largely enhance the efficiency and quality of development. Sibelius Manuscript Language is required if anyone who wants to make a BrailleOrch export plugin for Sibelius. Some items in Sibelius can't be correctly exported into musicxml via its internal export function and/or Dolet For Sibelius plugin.

The software will run under any Microsoft Windows systems, from Windows 2000/XP to Windows 10, both 32 and 64 bits. A screen reader such as NVDA is required for announcing unicode braille objects. Music publishers and sighted braille transcribers are not asked for this option.

About BrailleOrch Format
BrailleOrch (.bor) format is a compressed file. It contains original musicxml (if transcribed from musicxml) and bmml sources, and additional debugging information such as error records. When the final editing and correction has been finished, the musicxml source and most debugging information can be removed to save file size. People can still edit and reformat braille output, though. See Make final document in File Menu.

Framework
This comprehensive document will describe all menus and functions of BrailleOrch. People who wants to develop/enhance the software must read it carefully.

Working Progress
Since this is a highly sophisticated software, we have to divide the development into several phases.

The first phase is to build up a general GUI, containing basic menus and functions. Use original BMML source and define braille music transcription rules. Missing signs in BMML DTD must be added. Basic functions in Page setup, Score/Part/Text management and Transcription options dialogs should be done. Bar-over-bar and line-over-line formats are firstly considered. The result braille music score can represent at least 95% information of the print score. The score can be manually edited, but not reformatted and retagged automatically, since this requires deeper research of BMML and further development of the software. The user-edited strings are gray-colored, and simply marked as "other" in BMML, and can be tagged in future versions of the software.

The second phase is to enhance transcription quality. Items in Musicxml 3.0 or later should be added, and the formatting function must be more flexible. Add section-by-section format. Enhance translation table to add support to Chinese Mandarin braille (Cantonese and Taiwanese Chinese braille have already been done in Liblouis).

The third phase is to enhance the reformatting function. The software can recognize most user-entered strings as music signs, texts etc, and can correctly break lines when reformatted.

The fourth phase is to develop a Sibelius plug-in, directly exporting .bor files from Sibelius. Musicxml exported from Sibelius has some information missing, because there are special user items. We can use Manuscript Language to make the braille version more close to the original score. Unspecified items can also be exported and tagged for manual editing.

The last phase is to develop the braille music composing side. Since the software can already recognize common braille music signs entered, the main focus is on advanced signs, creating parts and groups, writing chord symbols, handling visual appearance, Midi functions etc.

========================================

Chapter 1: Menu Overview
This chapter describes all menus and submenus. It gives us a brief view of the major functions of BrailleOrch.

1.1 File Menu
New
To create a new BMML document. This will not be considered currently, unless we decide to develop braille music composing side. Braille Music Editor 2 from Veia Progetti can do a intermediate level work of it, and blind musicians can now use ABC, Lilypond and Sibelius to produce print music scores. So our main goal is to develop a transcription software.

Open
Open a BMML file (.bmml), both original Veia version and our extended new version. Our new version contains more information and functions, so for portability purpose, it will be a compressed xml file with the extension .bor. Another kind of unprocessed .bor file can also be opened, see Import.

Open recent
A list of recent created/opened files. Number of files can be set or cleared in Options dialog.

Save
Save the current BMML file in either BMML or Bor format. The BMML format is not an old version of BMML, but an uncompressed Bor file. This can be used for researching the format to help developers get familiar with BMML.

Save As
Save the file using a different name or to a different location, in either BMML or Bor format.

Versioning (submenu)
Save Version
open Version
Versioning function is for further comparison of the score. The version files will be saved using .bor format, with a time/date stamp after the extension. E.G., foo.bor~01312016.
Saving an earlier version will bring up a dialog, asking whether you want to save a new version or overwrite the current non-version file.

Set copy protection
This is a special function for protecting music pubisher's copyright. After they convert their scores into musicxml and import into BrailleOrch, they can immediately set this option. The file can still be edited, reformatted and embossed, but can't be exported into musicxml for back-translation. The file is also encrypted, so it also can't be saved as bmml format. Any debugging process upon the xml source and bmml score can, however, be done using the internal debugging interface.
Be careful to use this function, since it's not reversable. We should provide two times of verification dialog for this. Another possibility is, we can toggle this item visible and invisible in the "Option" dialog, to prevent accidental operation by common users.

Make final document
Be careful to use it like Set copy protection. This will remove musicxml source and most debugging information from the file. So don't use it before the final correction of braille music is done, especially when there are errors. As I said before, the metadata will be protected using Set copy protection function, so the protected musicxml source can't be extracted. So don't worry about the source. After making the final document, people can still edit and reformat braille music score, but can't debug and make enhancement of the software.

Close
Close All
Close the current working document(s).

Import
Import Musicxml files, from version 1.0 to the latest version, both compressed (.mxl) and uncompressed (.xml). The transcription process will begin, see Transcription dialog for details.
Import ASCII/unicode braille file, making ASCII2Unicode or vice versa conversion according to chosen braille table. This will not automatically generate a bmml format, but just storing and converting original data. This way, the .bor file is just a compressed version of original source. When we decide to develop braille music composing side, this situation will be changed.
Importing MIDI file will also be considered in the future.

Export
Export MIDI and Musicxml formats. This will be considered later.
Export to unicode or ASCII braille. This is the current function. When exporting to ASCII, an option dialog will appear for choosing a braille table. Different country uses different braille mapping table.

Page Setup
Settings for braille pages.
In this dialog:
Lines per page: line amount spin editbox, default 25
Cells per page: Cell amount spin editbox, default 32
Adding form feeds: checkbox for inserting form feeds. Default checked
Print page numbers: braille printing page numbers. Default checked
Print page number position: listbox, topleft, topright, bottomleft and bottomright. Default topleft
Braille page numbers: braille braille page numbers. Default checked
Braille page number position: listbox, topleft, topright, bottomleft and bottomright. Default topright
When these two positions get conflicted, a warning message will appear, asking the user to adjust the position correctly.

Emboss
Emboss braille music scores using installed braille embosser drivers.

Exit
Quit the software.

----------------------------------------

1.2 Edit Menu
Undo
Undo the previous operations.

Redo
Redo undone operations.

Undo history
A 128-step history list, to choose an undo item to roll back or forward.

Select all
Select all items.

Special selection (submenu)
Set begin of selection block (F5)
Set end of selection block (F6)
Set from begin to current location (F7)
Select from current location to end (F8)
Select line (F9)
(current print line of current part, from beginning to end measures)
Select part (F9)
(current part, for whole piece/movement)
select staff (F10)
(current braille staff)
Select system (F12)
(current braille system. System means a whole group of staves, showing all instruments and voices playing simultaneously.)
Remove selection (F4)
(remove the current selection. The selection will not be removed if this is pressed, or a new selection block is made.)

Cut/Copy/Paste/Delete
Cut/copy/paste/delete selection.

Search/replace
Common search/replace functions.
However, there's an checkbox to switch on "searching for texts", which switches of unicode braille input, and directly search within the xml sources for standard texts, including dynamics and any text-based values. The result will bring the cursor to correct braille location.

----------------------------------------

1.3 View Menu
The common view menu for sighted users. It includes simple view options such as zooming, visibility of toolbar, and braille reading modes etc.
Braille reading mode will give us options to choose white-screen-black-dots or black-screen-white/blue/green-dots.

----------------------------------------

1.4 Navigation Menu
Besides common arrow navigations of individual braille cells or lines, there are some special functions.

Next note (tab)
Previous note (shift+tab)
Next beat (alt+right)
Previous beat (alt+left)
Next measure (ctrl+right)
Previous measure (ctrl+left)
Next voice (win+right)
Previous voice (win+left)
Next part in the same measure (ctrl+down)
Previous part in the same measure (ctrl+up)
Next print line (alt+down)
Previous print line (alt+up)
Next braille system (win+down)
Previous braille system (win+up)
Next print system (ctrl+win+down)
Previous print system (ctrl+win+up)
Next braille page (pgdn)
Previous braille page (pgup)
Next print page (ctrl+pgdn)
Previous print page (ctrl+pgup)
Begin of current braille page (home)
End of current braille page (end)
Begin of current system (alt+home)
End of current system (alt+end)
Begin of file (ctrl+home)
End of file (ctrl+end)

Go to measure/part
Enter measure and part numbers. If measure number is left empty, then stay in the current measure; ff part number is left empty, then bring to the first part of the measure.

Go to selection (submenu)
Go to begin of selection (ctrl+F5)
Go to end of selection (Ctrl+F6)

----------------------------------------

1.5 Transcription Menu
This menu handles various transcription functions.

Bar-over-bar (default)
Line-over-line
Section-by-section
These 3 options will change the current format of score. The formatting will be done according to settings in Options dialog. We highly recommend people to set their preferred format as default in the Options dialog, to reduce any messy formatting problems.
All detailed options for these formats can be found and will be discussed in the Options Dialog section.
For single-staff instrument solo, the above will be unavailable, and settings for single-line format will be applied. See corresponding settings in Options dialog for details.

Reformat
Reformat the braille score after manual editing and correction. Formatting layout will follow rules set in Options and Page setup dialogs. Options changed after transcription process can also be applied.

Extract parts
Extract parts for players/singers. A dialog appears, letting you check part(s) to extract. New .bor documents with only bmml sources for individual parts will be created. You can change the order of parts, or choose whether to extract parts as individual files or just one file shwing parts one by one. If "combin individual parts" is checked, the result file will generate a full score containing selected parts (this is useful for publishing choral scores containing vocal parts only).

Combine parts to score
A reversed operation of part extraction. A dialog appears, letting you add files and adjust their order. But the files must be the whole parts of the same piece, otherwise BrailleOrch will refuse to go ahead. BrailleOrch will first check the coincidence of time and measure among all parts, and shows a warning message telling which file(s) are unmatched. BrailleOrch will check coincidence according to the topmost file.

----------------------------------------

1.6 Braille Music Menu
This menu gives us several functions of editing and correcting braille music score. Some are very sophisticated functions.
This menu will be modified and extended when we decide to develop braille music composing function.

Input (submenu)
Insert notes (n)
Enter notes/rests/voices, generally all music-related signs.
Insert texts (x)
Enter texts using standard input method. Untranslated unicode texts such as Chinese will be accepted, and can be edited later. All text-related adjustment can be done in Text management dialog.
Insert key signature (k)
Insert time signature (t)
These two use braille input.
Insert chord names and figured bass (c)
Braille input of chord and figure symbols.
Insert title page information (i)
Insert title info at top of system. See Score management dialog for details.
There's a checkbox for inserting title info on a blank page. If checked, a blank page will be created.
Insert footnotes (o)
Add a line of dots 3-5's plus footnotes.
Insert division signs (v)
Centered 12 division characters. Choose from dots 3-5 and dots 5.
Insert new print page (shift+p)
Insert new braille page (shift+b)
These are for modification and/or reformatting, or when no print pages are available in musicxml 1.0. Also useful when developing braille music composing. Print page will be inserted at the beginning of the measure, while braille page will be inserted at the beginning of the current braille line.
Set current measure (m)
Set number of current measure. The consequent measure numbers will be changed.
Set current braille page (b)
Set current braille page number. The extra choices for numbering are arabic, roman, lower-celled and (for title pages) none.
Set current print page (p)
Set current print page number. The extra choices are arabic, roman and none.

Other tags and properties can be marked by right-click on selected cell(s). Transcribers can also edit the score without using the above insert and right-click marking functions, but the result input will be marked as "other" in bmml, and can't be automatically reformatted correctly. They should be manually formatted.

Score management
A tool for managing various items such as page/measure numbering, movement divisions etc for the whole score or selected block. See corresponding chapter for details.

Part management
A very powerful tool for managing part names and grouping properties in the score. See corresponding chapter for details.

Text management
A very powerful tool for managing various text items in the score. See corresponding chapter for details.

Lyrics management
A tool for managing lyrics in the score. See corresponding chapter for details.

----------------------------------------

1.7 Playback Menu
Play/stop
Play current measure
Play current part
Play current voice
Play metronome (default unchecked)

Play sounds when navigating
Whether to play MIDI sounds during cursor navigation. Default: checked.

Playback device
To choose a soundcard for Midi playback.

----------------------------------------

1.8 Options Menu
Options
Comprehensive settings dialog. Discussed in separate chapter.

Announce modes (submenu)
silent
Braille only
Objects only
Braille and objects (default)

----------------------------------------

1.9 Window Menu
Standard window menu, such as tile, cascade etc.

----------------------------------------
1.10 Help Menu
About
User manual (F1)
Software website
Check for updates

========================================

Chapter 2: Deeper View Of Transcription Function
This is the core of the software, so please be careful to read it. For knowledge of braille music, please consult New International Manual Of Braille Music Notation (SBS, 1996) and Music Braille Code 1997 (BANA).

2.1 Transcription dialog
Note: All dialogs in this software have "ok" and "cancel" buttons.

When importing a Musicxml file, the software brings up a dialog, giving the users options for adjusting transcription appearance. It can be turned off by checking Don't show this dialog again at the bottom of the dialog, or via Options dialog. The last settings will be stored, and users can override these options in Options dialog. The Transcription dialog also contains lots of buttons to bring up corresponding options in that dialog.

Braille score format
Radio buttons: bar-over-bar, line-over-line and section-by-section. Default is bar-over-bar.
When one format is chosen, the corresponding option button will be shown, bringing user to corresponding items in Options dialog.

Page setup
Brings up Page setup dialog in File menu.

Score/Part/Text/Lyrics management
Bring up corresponding dialogs which are also available in Braille Music menu.

Transcription settings
Bring up Transcription settings in Options dialog.

Translation table
Used for text translation. This can also be seen in Options and Score/Part/Text/Lyrics management dialogs.

Don't show this dialog
Disable this dialog, using options previously set.

----------------------------------------

2.2 Score Management Dialog
Description of the score
This is a read-only text box, showing summary of the score. Available items are: general header, individual headers (headers with their starting print/braille pages), number of print/braille pages, number of measures, page format, score format (single-line, bar-over-bar, line-over-line, section-by-section).

Running header: some countries have running headers at the top of page. A general header can be set here. Some books use different header on different piece. This can be done by specifying individual headers using context menu within the score, and will override the general header.

Title/Composer/Lyricist/Copyright/Comments
These edit boxes will be automatically filled if they can be retrieved from Musicxml source. Otherwise the user can enter them here, and the braille will be automatically generated and formatted. User can also insert them form Insert title page information dialog under Input submenu of Braille Music menu. If entered as braille manually, they can also be tagged later using context menu.

Table of contents dialog
This can be written in the braille window, but can also be done here. The difference is, the one set here can function like TOC items in MS Word, bringing the user to corresponding location.
TOC title: Enter normal text, and the software can handle it correctly.
The TOC format is title plus dashes or dots (dot 3 or 5) plus page number. There are 2 columns, one for title, one for braille pages. Indentation is automatic.
Division patterns
Radio button: dashes (dots 3-6), dot 3 and dot 5.
Indentation: edit box. Default, by 2 cells

Context menu for the above items should add "Translation table".

Note: 1. Current untranslatabre texts such as Chinese characters can be manually translated via Text management dialog in context menu.
2. If items in this dialog are removed completely, and no user-entered info are on title and TOC pages, the blank pages will always be removed automatically. Division signs will be removed even they are not deleted here.

----------------------------------------

2.3 Part Management Dialog
Some Musicxml files have long part/abbreviation names, some have missing part/abbrev names, and some have group names for group of staves. These are not able to be transcribed correctly. Here's a powerful tool for solving this problem.
Part names and abbreviations will be automatically transcribed into braille, except Chinese, which can be edited in the Braille parts list table.
All line breaks in the Musicxml part field will be shown as \n, and discarded in braille version. Such kind of part names must be manually edited.

Print part list
List all original items in <score-partlist> of Musicxml.
Items in this extensive table view can be navigated using arrow keys, selected using shift+arrow, edited by pressing F2, and deleted using Del key. Its format is managed as follows:
group name, group abbreviation, part ID, part name, and part abbreviation.
Any item will be left empty when no one is found.
Staves in a group will display group name and abbrev on all staves.
When a multi-stave part is available, number or letter sequences will be added after the abbreviation names. Default is number.

Context menu items
Undo/Redo
Common undo/redo function.
Combine these staves
Piano/harp/organ parts in some orchestral scores are not grouped correctly. Select this to make selected staves into group.
Treat as piano
Change current group into piano format, thus adding hand signs before each staff. You can delete part names not belonging to the first staff.
Treat as organ
The same as piano, but treat the 3rd staff as organ pedal.
Treat as multi-stave parts
Some divisi parts have only two staves, and will be ocassionally transcribed as piano parts. Use this to turn them into common multi-stave parts.
Use group name
select if the part names in a group are missing or just arabic or roman numbers. E.g., some scores mark "Horns in F" as group name, and "I II" "III IV" as part names, no abbreviations or abbreviations are the same as part names. But such modified abbreviation names must still be edited for braille use.
Use letter sequences for multi-stave part
Select if you want to use letters for current multi-stave part, e.g., vln1a, where numbers have already been used.

Braille part list
This table is used for editing braille which can't be correctly transcribed. Braille input will be activated by pressing F2.

These two tables are linked, so scrolling one of them will also make the other scroll.

List part and abbreviation names
This checkbox will generate new braille page(s) before the first music page. The list will show all parts and braille abbrev names edited in the above tables. 2-cell indentation for long names is automatic. New line can also be entered by pressing shift+enter in braille input mode in Braille part list table.

----------------------------------------

2.4 Text Management Dialog
A comprehensive dialog like Part management dialog. It lists out all texts items in the score. For dialog opened this way, only words and DoletSibelius unrecognized system texts are listed. When opened using context menu, items such as title page and TOC info can be displayed.

Text list
A same table as part list, but with different layout:
measure, beat, part, voice, text, braille
The list is sorted timewisely by default. Blank spaces at the beginning/end of text block will be automatically removed, and can be manually entered in braille if needed.
One difference is, the Del key will remove the text from the score. So please use F2 to clear and re-edit it.

Context menu
Undo/Redo
Common undo/redo function.
Translation table
Choose one for current text. When using word signs, all uppercase will be ignored.
Mark as dynamic
Some special dynamic markings such as "sffzp" are not treated as dynamic in notation programs. This will tag the current text as dynamic mark.
Put word signs before every word
Long text blocks
Use parenthesis
These are 3 different functions. The first adds dots 3-4-5 before every word in the text block; the second puts dots 3-4-5 around the whole block, and makes a space before (except fore after part name, hand sign, sign for begin of repetition and clef sign) and after (except for end of line) the block; and the last adds parenthesis to the block, with a space before (except for the same condition) and after (except for the same condition) it.
Chinese texts
This will add Chinese music parenthesis (dots 5-6 3-6 and dots 3-6 2-3) around the text. Once the Chinese translation is available, this option will be removed.
Treat as texts outside music
Treat as texts inside music
These 2 opposite items will move current text item outside or inside the score. When outside the music, it will be normal text without any word signs. You can still add parenthesis around it. The format of text can be freely edited in the braille score itself.
Combine selected texts
Select at least two text items and choose this option. It brings up a dialog showing the result for you to edit, e.g., adding space etc. Sometimes special dynamics are entered this way, e.g.,, "sf-mf", entered as "sf" "-" and "mf", should be combined into one text item. Only items in the same voice, the same part and the same measure can be combined.
Split text
Split current text block into separate ones. A dialog appears, and you can press shift+enter at the position you want to split.
Move text
Move current text to different voice/part. A dialog will let you scroll through the part+voice to re-place the text. When the same beat position is not available due to note/rest value difference, the text will be shifted backwards to the nearest note/rest.
Hyphenation
For long text blocks, hyphenation is required. The options are (English) End of line and (Chinese) Begin of line.

----------------------------------------

2.5 Lyrics Management Dialog
A dialog showing table like Text management. The layout is:
part, lyrics
But since the lyrics are long blocks, they will not be displayed completely here. The beginning 5 words will be shown, and when pressing F2, a dialog containing multiple line editbox will appear for you to edit. In the dialog, there are radio buttons to switch between print and braille mode.

Context menu
Undo/Redo
Common undo/redo function.
Translation table
Listbox. Choose a table for current selected lyrics part.

Chinese lyrics
Checkbox. Chinese lyrics has different format from English one. This will be done later (todo item).

Use lyric sign
Checkbox. Toggle lyric sign (dots 5-6 2-3) on/off. Some countries don't use lyric sign.

Lyrics position
Radio button, put lyric line above/below music.

Use repetition
Checkbox. If same word(s) are repeated, use repeat signs (one or two dots 3-5's and one 3-5 around the block, or number plus dots 3-5 before and dots 3-5 alone after it, when repetition is more than 3 times).

========================================

notes From Scratch:
(All the following will be moved to their appropriate positions as the framework is being composed)
02/23/2016
Add Part/Text management dialogs to context menu, so that the user can control individual item or selected items on-the-fly. The listbox in the dialogs will display selected one(s). Dialogs opened in Braille Music menu will always list out all items.
02/23/2016
Part/text braille can be edited by simply pressing F2 on the one under cursor. It isn't necessary to bring up the management dialogs in such a simple case.
  
